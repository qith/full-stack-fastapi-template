# PMinfo 服务器部署检查清单

使用此清单确保部署过程完整无误。

## 📋 部署前准备

### 服务器准备
- [ ] 服务器已准备就绪（Linux系统）
- [ ] 已获得服务器root或sudo权限
- [ ] 服务器系统已更新
- [ ] 防火墙已配置（开放80和443端口）

### 域名和DNS
- [ ] 已购买域名
- [ ] DNS A记录已配置：`*.yourdomain.com` → 服务器IP
- [ ] DNS A记录已配置：`yourdomain.com` → 服务器IP
- [ ] DNS记录已生效（使用 `dig` 或 `nslookup` 验证）

### 环境准备
- [ ] Docker已安装
- [ ] Docker Compose已安装
- [ ] Git已安装（如果使用Git部署）

---

## 🔧 安装和配置

### Docker安装
- [ ] Docker Engine已安装
- [ ] Docker Compose已安装
- [ ] Docker服务正在运行
- [ ] 当前用户已加入docker组（或使用sudo）

### Traefik配置
- [ ] 已创建 `/root/code/traefik-public` 目录
- [ ] `docker-compose.traefik.yml` 已上传到服务器
- [ ] `traefik-public` Docker网络已创建
- [ ] Traefik环境变量已设置：
  - [ ] `USERNAME` (Traefik管理面板用户名)
  - [ ] `PASSWORD` (Traefik管理面板密码)
  - [ ] `HASHED_PASSWORD` (使用openssl生成)
  - [ ] `DOMAIN` (您的域名)
  - [ ] `EMAIL` (Let's Encrypt邮箱)
- [ ] Traefik服务已启动
- [ ] Traefik管理面板可访问：`https://traefik.yourdomain.com`

---

## 📦 应用部署

### 代码准备
- [ ] 项目代码已上传到服务器
- [ ] 已进入项目根目录

### 环境变量配置
- [ ] `.env` 文件已创建
- [ ] 所有必要的环境变量已设置：
  - [ ] `ENVIRONMENT=production`
  - [ ] `DOMAIN` (与Traefik配置一致)
  - [ ] `STACK_NAME` (唯一标识符)
  - [ ] `SECRET_KEY` (已生成强密钥)
  - [ ] `FIRST_SUPERUSER` (管理员邮箱)
  - [ ] `FIRST_SUPERUSER_PASSWORD` (管理员密码)
  - [ ] `POSTGRES_PASSWORD` (数据库密码)
  - [ ] `FRONTEND_HOST` (前端URL)
  - [ ] `BACKEND_CORS_ORIGINS` (CORS配置)
  - [ ] 其他可选配置（SMTP、Sentry等）

### 安全配置
- [ ] 所有默认密码已更改
- [ ] `SECRET_KEY` 已使用强密钥（32字符以上）
- [ ] `POSTGRES_PASSWORD` 已使用强密码
- [ ] 管理员密码已设置

### 构建和启动
- [ ] Docker镜像已构建（或使用现有镜像）
- [ ] 所有服务已启动
- [ ] 服务状态正常（使用 `docker compose ps` 检查）

---

## ✅ 验证部署

### 服务检查
- [ ] 所有Docker容器状态为 `Up`
- [ ] 数据库服务正常运行
- [ ] 后端服务正常运行
- [ ] 前端服务正常运行
- [ ] 没有错误日志

### 访问测试
- [ ] 前端可访问：`https://dashboard.yourdomain.com`
- [ ] API文档可访问：`https://api.yourdomain.com/docs`
- [ ] API健康检查通过：`https://api.yourdomain.com/api/v1/utils/health-check/`
- [ ] 数据库管理可访问：`https://adminer.yourdomain.com`
- [ ] Traefik面板可访问：`https://traefik.yourdomain.com`

### HTTPS证书
- [ ] 所有URL使用HTTPS
- [ ] 浏览器显示绿色锁图标
- [ ] 证书由Let's Encrypt签发
- [ ] 证书有效期正常

### 功能测试
- [ ] 可以使用管理员账户登录
- [ ] 前端可以正常访问后端API
- [ ] 数据库连接正常
- [ ] 主要功能可以正常使用

---

## 🔒 安全加固

### 基础安全
- [ ] 所有默认密码已更改
- [ ] 使用强密码和密钥
- [ ] 防火墙已配置
- [ ] 不必要的端口已关闭

### 应用安全
- [ ] CORS配置正确
- [ ] 环境变量未泄露敏感信息
- [ ] `.env` 文件权限正确（600）
- [ ] 日志不包含敏感信息

### 系统安全
- [ ] SSH密钥认证已配置
- [ ] 系统定期更新
- [ ] 监控和日志已配置

---

## 📊 维护准备

### 备份配置
- [ ] 数据库备份脚本已测试
- [ ] 自动备份已配置（crontab）
- [ ] 备份存储位置已确定
- [ ] 备份恢复流程已测试

### 监控配置
- [ ] 服务监控已配置
- [ ] 日志收集已配置
- [ ] 告警机制已设置

### 文档
- [ ] 部署文档已保存
- [ ] 环境变量配置已记录
- [ ] 访问地址已记录
- [ ] 管理员账户信息已安全保存

---

## 🚀 部署后操作

### 立即执行
- [ ] 测试所有主要功能
- [ ] 验证数据完整性
- [ ] 检查性能指标
- [ ] 确认所有服务正常运行

### 短期任务（1周内）
- [ ] 配置邮件服务（如需要）
- [ ] 设置Sentry错误监控（如需要）
- [ ] 配置定期备份
- [ ] 设置监控告警

### 长期任务
- [ ] 定期更新系统和依赖
- [ ] 定期检查安全更新
- [ ] 定期审查日志
- [ ] 定期测试备份恢复

---

## 📝 部署信息记录

记录以下信息以便后续维护：

**服务器信息**
- 服务器IP: ________________
- 服务器提供商: ________________
- 操作系统版本: ________________

**域名信息**
- 主域名: ________________
- DNS提供商: ________________

**访问地址**
- 前端: https://dashboard.________________
- API: https://api.________________
- 数据库管理: https://adminer.________________
- Traefik: https://traefik.________________

**管理员账户**
- 邮箱: ________________
- 密码: ________________ (已安全保存)

**数据库信息**
- 数据库名: ________________
- 用户名: ________________
- 密码: ________________ (已安全保存)

**重要密钥**
- SECRET_KEY: ________________ (已安全保存)
- POSTGRES_PASSWORD: ________________ (已安全保存)

**部署日期**
- 部署时间: ________________
- 部署人员: ________________

---

## ❓ 遇到问题？

如果部署过程中遇到问题：

1. 查看日志：`docker compose logs -f`
2. 检查服务状态：`docker compose ps`
3. 参考详细文档：`服务器部署指南.md`
4. 检查常见问题章节

---

**部署完成后，请妥善保管此清单和所有敏感信息！**

