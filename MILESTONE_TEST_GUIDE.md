# 里程碑功能测试指南

## 🚀 快速开始

### 前提条件
- 后端服务运行在 `http://localhost:8000`
- 前端服务运行在 `http://localhost:5174`
- 已登录系统（admin@example.com / changethis）

## 📋 测试步骤

### 测试 1：创建带里程碑的项目

**目标**：验证在创建项目时可以同时添加里程碑计划

**步骤**：
1. 访问 `http://localhost:5174/project-management`
2. 点击右上角"添加项目"按钮
3. 填写项目基本信息：
   - 项目名称：`新疆某银行数字化转型项目`
   - 项目类型：`交付`
   - 项目属地：`华北`
   - 产品名称：`核心银行系统`
   - 合同金额：`8000000`
   - 项目背景：`新疆某银行希望通过数字化转型提升服务效率`

4. 滚动到"项目里程碑计划"部分
5. 点击"添加里程碑"按钮，添加第一个里程碑：
   - 完成时间：`2025-11-01`
   - 里程碑名称：`需求调研完成`
   - 状态：`正常`

6. 再次点击"添加里程碑"，添加第二个里程碑：
   - 完成时间：`2025-11-15`
   - 里程碑名称：`系统架构设计完成`
   - 状态：`正常`

7. 继续添加更多里程碑：
   - `2025-12-01` - `开发环境搭建完成` - `正常`
   - `2025-12-31` - `核心模块开发完成` - `正常`
   - `2026-01-15` - `系统集成测试通过` - `正常`
   - `2026-02-01` - `用户验收测试完成` - `正常`
   - `2026-02-15` - `系统正式上线` - `正常`

8. 点击"保存"按钮

**预期结果**：
- ✅ 项目创建成功
- ✅ 页面显示新创建的项目卡片
- ✅ 统计数据更新

---

### 测试 2：查看项目时间轴

**目标**：验证里程碑在时间轴上的展示效果

**步骤**：
1. 在项目列表中找到刚创建的"新疆某银行数字化转型项目"
2. 点击项目卡片上的"查看详情"按钮（眼睛图标）
3. 在弹出的对话框中，点击"时间计划"标签页

**预期结果**：
- ✅ 显示 Material UI Timeline 组件
- ✅ 所有里程碑按时间顺序排列（从早到晚）
- ✅ 每个里程碑显示：
  - 左侧：完成日期（2025-11-01）
  - 中间：状态图标（蓝色时钟图标）
  - 右侧：里程碑卡片（名称 + 状态标签）
- ✅ 里程碑之间有连接线
- ✅ 左右交替布局

---

### 测试 3：在详情页添加新里程碑

**目标**：验证在项目创建后可以动态添加里程碑

**步骤**：
1. 在项目详情对话框的"时间计划"标签页
2. 点击右上角"添加里程碑"按钮
3. 在弹出的对话框中填写：
   - 里程碑日期：`2026-03-01`
   - 里程碑描述：`系统优化完成`
   - 状态：`正常`
4. 点击"保存"按钮

**预期结果**：
- ✅ 对话框关闭
- ✅ 新里程碑出现在时间轴上
- ✅ 自动按时间顺序插入到正确位置
- ✅ 有新的连接线

---

### 测试 4：编辑项目并修改里程碑

**目标**：验证可以通过编辑项目来更新里程碑

**步骤**：
1. 关闭项目详情对话框
2. 在项目卡片上点击"编辑"按钮（铅笔图标）
3. 滚动到"项目里程碑计划"部分
4. 修改第一个里程碑：
   - 将"需求调研完成"改为"需求分析与调研完成"
   - 将状态改为"完成"
5. 删除一个里程碑（点击删除图标）
6. 添加一个新里程碑：
   - `2026-04-01` - `项目总结与验收` - `正常`
7. 点击"保存"按钮

**预期结果**：
- ✅ 项目更新成功
- ✅ 再次查看详情，时间轴显示更新后的里程碑
- ✅ 被删除的里程碑不再显示
- ✅ 新添加的里程碑正确显示

---

### 测试 5：里程碑状态可视化

**目标**：验证不同状态的里程碑显示不同的颜色和图标

**步骤**：
1. 创建一个新项目"测试项目 - 状态展示"
2. 添加三个里程碑，分别设置不同状态：
   - `2025-10-01` - `第一阶段` - `完成`
   - `2025-10-15` - `第二阶段` - `延期`
   - `2025-10-30` - `第三阶段` - `正常`
3. 保存并查看项目详情的时间计划

**预期结果**：
- ✅ "完成"状态：
  - 绿色圆点
  - ✅ 打勾图标
  - 绿色"完成"标签
- ✅ "延期"状态：
  - 红色圆点
  - ⚠️ 警告图标
  - 红色"延期"标签
- ✅ "正常"状态：
  - 蓝色圆点
  - 🕐 时钟图标
  - 蓝色"正常"标签

---

### 测试 6：空里程碑处理

**目标**：验证没有里程碑的项目的显示

**步骤**：
1. 创建一个新项目"测试项目 - 无里程碑"
2. 不添加任何里程碑，直接保存
3. 查看项目详情的时间计划标签页

**预期结果**：
- ✅ 显示友好提示："暂无里程碑信息"
- ✅ 显示"添加第一个里程碑"按钮
- ✅ 点击按钮可以添加里程碑

---

### 测试 7：API 测试（使用 curl）

**目标**：验证后端 API 正常工作

**测试创建带里程碑的项目**：

```bash
# 1. 获取 access token
TOKEN=$(curl -s -X POST http://localhost:8000/api/v1/login/access-token \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=admin@example.com&password=changethis" \
  | python3 -c "import sys, json; print(json.load(sys.stdin)['access_token'])")

# 2. 创建带里程碑的项目
curl -X POST http://localhost:8000/api/v1/projects/ \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "API测试项目",
    "project_type": "PoC",
    "location": "华南",
    "product": "测试产品",
    "contract_amount": 100000,
    "milestones": [
      {
        "milestone_date": "2025-11-01T00:00:00Z",
        "description": "第一阶段完成",
        "status": "正常"
      },
      {
        "milestone_date": "2025-11-15T00:00:00Z",
        "description": "第二阶段完成",
        "status": "正常"
      }
    ]
  }'
```

**预期结果**：
- ✅ 返回 200 OK
- ✅ 响应包含项目信息和里程碑数组
- ✅ 里程碑数组包含 2 个元素

---

## 🐛 常见问题

### 问题 1：里程碑保存后不显示

**可能原因**：
- 前端未重新获取项目数据
- 后端关联查询未加载里程碑

**解决方法**：
1. 检查浏览器控制台是否有错误
2. 刷新页面重新加载数据
3. 检查后端日志

### 问题 2：时间轴显示顺序错误

**可能原因**：
- 日期格式不正确
- 时区转换问题

**解决方法**：
1. 检查里程碑日期是否为有效的 ISO 8601 格式
2. 查看浏览器控制台的时间解析

### 问题 3：添加里程碑时报错

**可能原因**：
- 必填字段为空
- 日期格式不正确
- 用户 ID 无效（进展跟踪）

**解决方法**：
1. 检查表单验证提示
2. 查看浏览器控制台错误信息
3. 检查后端日志

---

## ✅ 测试检查清单

- [ ] 创建项目时可以添加里程碑
- [ ] 里程碑按时间顺序排列
- [ ] 不同状态显示不同颜色和图标
- [ ] 可以在详情页添加新里程碑
- [ ] 可以编辑项目修改里程碑
- [ ] 可以删除里程碑
- [ ] 空里程碑显示友好提示
- [ ] 时间轴布局美观、响应式
- [ ] API 测试通过
- [ ] 前后端数据一致

---

## 📊 测试结果报告模板

```
测试日期：2025-10-19
测试人员：[姓名]
测试环境：
- 后端：http://localhost:8000
- 前端：http://localhost:5174
- 浏览器：Chrome/Safari/Firefox [版本]

测试结果：
✅ 测试 1：创建带里程碑的项目 - 通过
✅ 测试 2：查看项目时间轴 - 通过
✅ 测试 3：在详情页添加新里程碑 - 通过
✅ 测试 4：编辑项目并修改里程碑 - 通过
✅ 测试 5：里程碑状态可视化 - 通过
✅ 测试 6：空里程碑处理 - 通过
✅ 测试 7：API 测试 - 通过

问题记录：
- [问题描述]
- [重现步骤]
- [截图]

总结：
[测试总结]
```

---

## 🎯 下一步

测试完成后，可以继续测试：
1. 进展跟踪功能
2. 角色分配功能
3. 项目统计功能
4. 数据导出功能

